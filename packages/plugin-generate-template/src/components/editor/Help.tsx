import { FunctionalComponent } from 'preact';
import { useEffect } from 'preact/hooks';

import { Container } from '@/components/editor/TemplateEditor.styled';
import { decodeBase64, encodeBase64 } from '@/core/helper';
import { useEditor } from '@/hooks/useEditor';

interface Props {}

const HELP =
  'aW50ZXJmYWNlIERBVEEgewogIHN0YXRlOiBTdGF0ZTsKICBoZWxwZXI6IEhlbHBlcjsKICBkYXRhVHlwZXM6IEFycmF5PHsgbmFtZTogc3RyaW5nOyB0eXBlOiBzdHJpbmcgfT47Cn0KCmludGVyZmFjZSBIZWxwZXIgewogIGNhbWVsQ2FzZSh2YWx1ZTogc3RyaW5nKTogc3RyaW5nOwogIHNuYWtlQ2FzZSh2YWx1ZTogc3RyaW5nKTogc3RyaW5nOwogIHBhc2NhbENhc2UodmFsdWU6IHN0cmluZyk6IHN0cmluZzsKfQoKaW50ZXJmYWNlIFN0YXRlIHsKICBjYW52YXNTdGF0ZTogQ2FudmFzU3RhdGU7CiAgdGFibGVTdGF0ZTogVGFibGVTdGF0ZTsKICBtZW1vU3RhdGU6IE1lbW9TdGF0ZTsKICByZWxhdGlvbnNoaXBTdGF0ZTogUmVsYXRpb25zaGlwU3RhdGU7Cn0KCmludGVyZmFjZSBDYW52YXNTdGF0ZSB7CiAgdmVyc2lvbjogc3RyaW5nOwogIHdpZHRoOiBudW1iZXI7CiAgaGVpZ2h0OiBudW1iZXI7CiAgc2Nyb2xsVG9wOiBudW1iZXI7CiAgc2Nyb2xsTGVmdDogbnVtYmVyOwogIHpvb21MZXZlbDogbnVtYmVyOwogIHNob3c6IFNob3c7CiAgZGF0YWJhc2U6IERhdGFiYXNlOwogIGRhdGFiYXNlTmFtZTogc3RyaW5nOwogIGNhbnZhc1R5cGU6IHN0cmluZzsKICBsYW5ndWFnZTogTGFuZ3VhZ2U7CiAgdGFibGVDYXNlOiBOYW1lQ2FzZTsKICBjb2x1bW5DYXNlOiBOYW1lQ2FzZTsKICBoaWdobGlnaHRUaGVtZTogSGlnaGxpZ2h0VGhlbWU7CiAgYnJhY2tldFR5cGU6IEJyYWNrZXRUeXBlOwogIHNldHRpbmc6IFNldHRpbmc7CiAgcGx1Z2luU2VyaWFsaXphdGlvbk1hcDogUmVjb3JkPHN0cmluZywgc3RyaW5nPjsKfQoKaW50ZXJmYWNlIFNob3cgewogIHRhYmxlQ29tbWVudDogYm9vbGVhbjsKICBjb2x1bW5Db21tZW50OiBib29sZWFuOwogIGNvbHVtbkRhdGFUeXBlOiBib29sZWFuOwogIGNvbHVtbkRlZmF1bHQ6IGJvb2xlYW47CiAgY29sdW1uQXV0b0luY3JlbWVudDogYm9vbGVhbjsKICBjb2x1bW5QcmltYXJ5S2V5OiBib29sZWFuOwogIGNvbHVtblVuaXF1ZTogYm9vbGVhbjsKICBjb2x1bW5Ob3ROdWxsOiBib29sZWFuOwogIHJlbGF0aW9uc2hpcDogYm9vbGVhbjsKfQp0eXBlIFNob3dLZXkgPSBrZXlvZiBTaG93OwoKaW50ZXJmYWNlIFNldHRpbmcgewogIHJlbGF0aW9uc2hpcERhdGFUeXBlU3luYzogYm9vbGVhbjsKICBjb2x1bW5PcmRlcjogQ29sdW1uVHlwZVtdOwp9Cgp0eXBlIENvbHVtblR5cGUgPQogIHwgJ2NvbHVtblVuaXF1ZScKICB8ICdjb2x1bW5BdXRvSW5jcmVtZW50JwogIHwgJ2NvbHVtbk5hbWUnCiAgfCAnY29sdW1uRGF0YVR5cGUnCiAgfCAnY29sdW1uTm90TnVsbCcKICB8ICdjb2x1bW5EZWZhdWx0JwogIHwgJ2NvbHVtbkNvbW1lbnQnOwoKdHlwZSBEYXRhYmFzZSA9CiAgfCAnTWFyaWFEQicKICB8ICdNU1NRTCcKICB8ICdNeVNRTCcKICB8ICdPcmFjbGUnCiAgfCAnUG9zdGdyZVNRTCcKICB8ICdTUUxpdGUnOwoKdHlwZSBMYW5ndWFnZSA9CiAgfCAnR3JhcGhRTCcKICB8ICdDIycKICB8ICdKYXZhJwogIHwgJ0tvdGxpbicKICB8ICdUeXBlU2NyaXB0JwogIHwgJ0pQQScKICB8ICdTY2FsYSc7Cgp0eXBlIE5hbWVDYXNlID0gJ25vbmUnIHwgJ2NhbWVsQ2FzZScgfCAncGFzY2FsQ2FzZScgfCAnc25ha2VDYXNlJzsKCnR5cGUgSGlnaGxpZ2h0VGhlbWUgPQogIHwgJ0F0b21PbmVEYXJrJwogIHwgJ0F0b21PbmVMaWdodCcKICB8ICdNb25va2FpU3VibGltZScKICB8ICdHaXRodWJHaXN0JwogIHwgJ1ZTMjAxNSc7Cgp0eXBlIEJyYWNrZXRUeXBlID0gJ25vbmUnIHwgJ2RvdWJsZVF1b3RlJyB8ICdzaW5nbGVRdW90ZScgfCAnYmFja3RpY2snOwoKaW50ZXJmYWNlIFRhYmxlU3RhdGUgewogIHRhYmxlczogVGFibGVbXTsKICBpbmRleGVzOiBJbmRleFtdOwp9CgppbnRlcmZhY2UgUHVyZVRhYmxlIHsKICBpZDogc3RyaW5nOwogIG5hbWU6IHN0cmluZzsKICBjb21tZW50OiBzdHJpbmc7CiAgY29sdW1uczogQ29sdW1uW107CiAgdWk6IFRhYmxlVUk7CiAgdmlzaWJsZT86IGJvb2xlYW47Cn0KCmludGVyZmFjZSBUYWJsZSBleHRlbmRzIFB1cmVUYWJsZSB7CiAgd2lkdGgoKTogbnVtYmVyOwogIGhlaWdodCgpOiBudW1iZXI7CiAgbWF4V2lkdGhDb2x1bW4oKTogQ29sdW1uV2lkdGg7Cn0KCmludGVyZmFjZSBDb2x1bW5XaWR0aCB7CiAgd2lkdGg6IG51bWJlcjsKICBuYW1lOiBudW1iZXI7CiAgY29tbWVudDogbnVtYmVyOwogIGRhdGFUeXBlOiBudW1iZXI7CiAgZGVmYXVsdDogbnVtYmVyOwogIG5vdE51bGw6IG51bWJlcjsKICBhdXRvSW5jcmVtZW50OiBudW1iZXI7CiAgdW5pcXVlOiBudW1iZXI7Cn0KCmludGVyZmFjZSBUYWJsZVVJIHsKICBhY3RpdmU6IGJvb2xlYW47CiAgdG9wOiBudW1iZXI7CiAgbGVmdDogbnVtYmVyOwogIHpJbmRleDogbnVtYmVyOwogIHdpZHRoTmFtZTogbnVtYmVyOwogIHdpZHRoQ29tbWVudDogbnVtYmVyOwogIGNvbG9yPzogc3RyaW5nOwp9CgppbnRlcmZhY2UgQ29sdW1uIHsKICBpZDogc3RyaW5nOwogIG5hbWU6IHN0cmluZzsKICBjb21tZW50OiBzdHJpbmc7CiAgZGF0YVR5cGU6IHN0cmluZzsKICBkZWZhdWx0OiBzdHJpbmc7CiAgb3B0aW9uOiBDb2x1bW5PcHRpb247CiAgdWk6IENvbHVtblVJOwp9CgppbnRlcmZhY2UgQ29sdW1uT3B0aW9uIHsKICBhdXRvSW5jcmVtZW50OiBib29sZWFuOwogIHByaW1hcnlLZXk6IGJvb2xlYW47CiAgdW5pcXVlOiBib29sZWFuOwogIG5vdE51bGw6IGJvb2xlYW47Cn0KCnR5cGUgQ29sdW1uT3B0aW9uS2V5ID0ga2V5b2YgQ29sdW1uT3B0aW9uOwoKaW50ZXJmYWNlIENvbHVtblVJIHsKICBhY3RpdmU6IGJvb2xlYW47CiAgcGs6IGJvb2xlYW47CiAgZms6IGJvb2xlYW47CiAgcGZrOiBib29sZWFuOwogIHdpZHRoTmFtZTogbnVtYmVyOwogIHdpZHRoQ29tbWVudDogbnVtYmVyOwogIHdpZHRoRGF0YVR5cGU6IG51bWJlcjsKICB3aWR0aERlZmF1bHQ6IG51bWJlcjsKfQoKaW50ZXJmYWNlIEluZGV4IHsKICBpZDogc3RyaW5nOwogIG5hbWU6IHN0cmluZzsKICB0YWJsZUlkOiBzdHJpbmc7CiAgY29sdW1uczogSW5kZXhDb2x1bW5bXTsKICB1bmlxdWU6IGJvb2xlYW47Cn0KCmludGVyZmFjZSBJbmRleENvbHVtbiB7CiAgaWQ6IHN0cmluZzsKICBvcmRlclR5cGU6IE9yZGVyVHlwZTsKfQoKdHlwZSBPcmRlclR5cGUgPSAnQVNDJyB8ICdERVNDJzsKCmludGVyZmFjZSBNZW1vU3RhdGUgewogIG1lbW9zOiBNZW1vW107Cn0KCmludGVyZmFjZSBNZW1vIHsKICBpZDogc3RyaW5nOwogIHZhbHVlOiBzdHJpbmc7CiAgdWk6IE1lbW9VSTsKfQoKaW50ZXJmYWNlIE1lbW9VSSB7CiAgYWN0aXZlOiBib29sZWFuOwogIHRvcDogbnVtYmVyOwogIGxlZnQ6IG51bWJlcjsKICB3aWR0aDogbnVtYmVyOwogIGhlaWdodDogbnVtYmVyOwogIHpJbmRleDogbnVtYmVyOwogIGNvbG9yPzogc3RyaW5nOwp9CgppbnRlcmZhY2UgUmVsYXRpb25zaGlwU3RhdGUgewogIHJlbGF0aW9uc2hpcHM6IFJlbGF0aW9uc2hpcFtdOwp9CgppbnRlcmZhY2UgUmVsYXRpb25zaGlwIHsKICBpZDogc3RyaW5nOwogIGlkZW50aWZpY2F0aW9uOiBib29sZWFuOwogIHJlbGF0aW9uc2hpcFR5cGU6IFJlbGF0aW9uc2hpcFR5cGU7CiAgc3RhcnRSZWxhdGlvbnNoaXBUeXBlPzogU3RhcnRSZWxhdGlvbnNoaXBUeXBlOwogIHN0YXJ0OiBSZWxhdGlvbnNoaXBQb2ludDsKICBlbmQ6IFJlbGF0aW9uc2hpcFBvaW50OwogIGNvbnN0cmFpbnROYW1lPzogc3RyaW5nOwogIHZpc2libGU/OiBib29sZWFuOwp9CgppbnRlcmZhY2UgUmVsYXRpb25zaGlwUG9pbnQgewogIHRhYmxlSWQ6IHN0cmluZzsKICBjb2x1bW5JZHM6IHN0cmluZ1tdOwogIHg6IG51bWJlcjsKICB5OiBudW1iZXI7CiAgZGlyZWN0aW9uOiBEaXJlY3Rpb247Cn0KCmludGVyZmFjZSBQb2ludCB7CiAgeDogbnVtYmVyOwogIHk6IG51bWJlcjsKfQoKdHlwZSBSZWxhdGlvbnNoaXBUeXBlID0KICB8ICdaZXJvT25lTicKICB8ICdaZXJvT25lJwogIHwgJ1plcm9OJwogIHwgJ09uZU9ubHknCiAgfCAnT25lTicKICB8ICdPbmUnCiAgfCAnTic7Cgp0eXBlIFN0YXJ0UmVsYXRpb25zaGlwVHlwZSA9ICdSaW5nJyB8ICdEYXNoJzsKCnR5cGUgRGlyZWN0aW9uID0gJ2xlZnQnIHwgJ3JpZ2h0JyB8ICd0b3AnIHwgJ2JvdHRvbSc7';

const Help: FunctionalComponent<Props> = () => {
  const [parentRef, editorRef] = useEditor({ typescript: true, onChange });

  function onChange() {
    const text = editorRef.current.state.doc.toString();
    console.log('Help', encodeBase64(text));
  }

  const setEditorValue = (value: string) => {
    const editor = editorRef.current;
    const text = editor.state.doc.toString();

    editor.dispatch({
      changes: [
        { from: 0, to: text.length, insert: '' },
        { from: 0, insert: value },
      ],
    });
  };

  useEffect(() => {
    setEditorValue(decodeBase64(HELP));
  }, []);

  return <Container className="scrollbar" ref={parentRef} />;
};

export default Help;
